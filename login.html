<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Domine Português - Login/Cadastro</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="style.css"/>
</head>
<body>
<header class="dp-header">
  <img src="logo.jpg" alt="Domine Português" class="dp-logo"/>
</header>
<main class="login-page">
  <div class="tab-buttons">
    <button id="tab-login" class="tab-active">Login</button>
    <button id="tab-register">Cadastrar</button>
  </div>
  <form id="loginForm" class="login-form" autocomplete="off">
    <h2 class="login-title">Acesse a plataforma</h2>
    <label for="emailLogin">E-mail</label>
    <input type="email" id="emailLogin" name="emailLogin" required autocomplete="username"/>
    <label for="passwordLogin">Senha</label>
    <input type="password" id="passwordLogin" name="passwordLogin" required autocomplete="current-password"/>
    <button type="submit" class="btn-primary">Entrar</button>
    <p class="error-msg" id="loginError"></p>
  </form>
  <form id="registerForm" class="login-form hidden" autocomplete="off">
    <h2 class="login-title">Cadastro de Aluno</h2>
    <label for="nameRegister">Nome completo</label>
    <input type="text" id="nameRegister" name="nameRegister" required autocomplete="name"/>
    <label for="emailRegister">E-mail</label>
    <input type="email" id="emailRegister" name="emailRegister" required autocomplete="email"/>
    <label for="passwordRegister">Senha</label>
    <input type="password" id="passwordRegister" name="passwordRegister" required/>
    <label for="codeTurma">Código da Turma</label>
    <input type="text" id="codeTurma" name="codeTurma" required/>
    <button type="submit" class="btn-primary">Cadastrar</button>
    <p class="error-msg" id="registerError"></p>
    <p class="success-msg" id="registerSuccess"></p>
  </form>
</main>
<script src="database.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', ()=>{
    const db = window.NEXUS_DB_SEED;
    const tabLogin = document.getElementById('tab-login');
    const tabRegister = document.getElementById('tab-register');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const errLogin = document.getElementById('loginError');
    const errRegister = document.getElementById('registerError');
    const succRegister = document.getElementById('registerSuccess');

    tabLogin.onclick = () => {
      tabLogin.classList.add('tab-active');
      tabRegister.classList.remove('tab-active');
      loginForm.classList.remove('hidden');
      registerForm.classList.add('hidden');
      errLogin.textContent = '';
      errRegister.textContent = '';
      succRegister.textContent = '';
    };
    tabRegister.onclick = () => {
      tabRegister.classList.add('tab-active');
      tabLogin.classList.remove('tab-active');
      registerForm.classList.remove('hidden');
      loginForm.classList.add('hidden');
      errLogin.textContent = '';
      errRegister.textContent = '';
      succRegister.textContent = '';
    };

    loginForm.onsubmit = e => {
      e.preventDefault();
      const email = loginForm.emailLogin.value.trim();
      const pwd = loginForm.passwordLogin.value.trim();
      const user = db.users.find(u => u.email === email && u.password === pwd);
      if (user) {
        sessionStorage.setItem('NEXUS_SESSION', JSON.stringify(user));
        window.location.href = 'index.html';
      } else {
        errLogin.textContent = 'Usuário ou senha incorretos.';
      }
    };

    registerForm.onsubmit = e => {
      e.preventDefault();
      errRegister.textContent = '';
      succRegister.textContent = '';
      const name = registerForm.nameRegister.value.trim();
      const email = registerForm.emailRegister.value.trim();
      const pwd = registerForm.passwordRegister.value.trim();
      const code = registerForm.codeTurma.value.trim();

      if (!name || !email || !pwd || !code) {
        errRegister.textContent = 'Preencha todos os campos.';
        return;
      }

      if (db.users.some(u => u.email === email)) {
        errRegister.textContent = 'Email já cadastrado.';
        return;
      }

      const turma = db.turmas.find(t => t.code === code);
      if (!turma) {
        errRegister.textContent = 'Código da turma inválido.';
        return;
      }

      const id = 'u' + Date.now();
      const aluno = { id, email, password: pwd, name, role: 'aluno' };
      db.users.push(aluno);
      db.alunos.push({ id, name, email });
      turma.alunos.push(id);

      localStorage.NEXUS_DATA = JSON.stringify(db);

      succRegister.textContent = 'Cadastro realizado! Faça login.';
      registerForm.reset();
    };

    tabLogin.click();
  });
</script>
</body>
</html>
